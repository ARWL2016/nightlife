'use strict';(function(){'use strict';function a(a,b,c,d,e,f,g,h,i){function j(){d.getDetails(m.placeid).then(function(a){m.result=e.formatHours(e.formatTags(a)[0]),m.result.rating&&(m.starRating=e.createStarRating(m.result.rating)),f.cache('result',m.result)}).catch(function(){i.logError('detail.controller.getDetails','api call error')}).finally(function(){return m.showSpinner=!1})}function k(){d.getPhoto(m.photoref).then(function(a){m.photoUrl=a,f.cache('photoUrl',a)}).catch(function(a){i.logError('detail.controller.getPhoto',a)})}function l(a){var b=e.editResult(m.result);c.addToDiary(m.user,b,a).then(function(){return h.$broadcast('eventAdded')}).catch(function(a){h.$broadcast('eventNotAdded'),i.logError('detail.controller.addLocationToDiary',a)})}var m=this;m.placeid=a.placeid,m.photoref=a.photoref,m.result,m.photoUrl,m.user=f.getUser(),m.starRating={integer:[],decimal:[]},m.parsedWebsiteUrl=function(){if(m.result&&m.result.website)return e.getDomainFromUrl(m.result.website)},m.message='',m.showSpinner=!1,g.$on('addToDiary',function(a,b){l(b)}),function(){m.showSpinner=!0;var a=f.getFromCache('result'),b=f.getFromCache('photoUrl');return a?(m.result=a,m.photoUrl=b,void(m.showSpinner=!1)):void(m.placeid?(j(),m.photoref&&k()):m.message='Sorry, details not available')}()}angular.module('app').controller('DetailController',a),a.$inject=['$routeParams','datetimeHelperService','diaryService','googleApiService','helperService','localStorageService','$scope','$rootScope','errorService']})();