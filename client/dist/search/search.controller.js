'use strict';(function(){'use strict';angular.module('app').controller('SearchController',['$location','googleApiService','helperService','localStorageService','categoryService',function(a,b,c,d,e){var f=this;f.location=d.getFromCache('location'),f.search={category:'',query:'',coords:''},f.results,f.showSpinner=!1,f.showDropdown=!1,f.categoryMatches=[],f.message,f.populateAutocomplete=function(){f.message='',f.search.category&&0<f.search.category.length&&(f.showDropdown=!0,f.categoryMatches=e.matchCategories(f.search.category))},f.selectFromAutocomplete=function(a){f.message='',f.search.category=a.target.innerText,f.categoryMatches=[]},f.removeAutocomplete=function(a){'category-dropdown'!==a.target.classname&&(f.showDropdown=!1)},f.submitQuery=function(){return f.location?e.isCategoryValid(f.search.category)?void(f.showSpinner=!0,b.textSearch(f.search).then(function(a){a.length?f.results=c.formatTags(a):f.message='Your search returned no results.'}).catch(function(){f.message='Oops! Something went wrong...',errorSvc.logError('search.controller.submitQuery','text search error')}).finally(function(){f.showSpinner=!1})):f.message='Invalid category. Please choose one from the list.':f.message='Please select a location.'};(function(){var a=d.getCachedResults();a&&(f.results=a.results,f.search.category=a.searchParams.category,f.search.query=a.searchParams.query),f.location&&(f.search.coords=f.location.coords.lat+','+f.location.coords.lng),d.clearCache('result')})()}])})();